<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan #{{ scan.id }}</title>
  <script src="/static/htmx.min.js"></script>
  <script>
    function scrollToBottom() {
      const logElement = document.getElementById('log');
      logElement.scrollTop = logElement.scrollHeight;
    }
  </script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f8f9fa;
      color: #343a40;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h1 {
      font-size: 1.75rem;
      color: #212529;
      margin-bottom: 0.5rem;
    }
    .status {
      font-weight: 600;
      color: #007bff;
    }
    .status.finished { color: #28a745; }
    .status.failed { color: #dc3545; }
    pre#log {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 1rem;
      border-radius: 0.375rem;
      overflow: auto;
      font-size: 0.9rem;
      max-height: 60vh;
      margin-top: 1rem;
    }
    button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border-radius: 0.375rem;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover { background-color: #218838; }
    button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }
    a {
      color: #007bff;
      text-decoration: none;
    }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üõ†Ô∏è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #{{ scan.id }}: <code>{{ scan.target }}</code></h1>
    <p><b>–°—Ç–∞—Ç—É—Å:</b> <span id="status" class="status {{ 'finished' if scan.status == 'finished' else 'failed' if scan.status == 'failed' else '' }}">{{ scan.status }}</span></p>

    <pre id="log">{{ scan.nmap_output }}{{ scan.nuclei_output }}</pre>

    <button 
      hx-get="/scan/{{ scan.id }}/log" 
      hx-trigger="every 2s" 
      hx-target="#log" 
      hx-swap="innerHTML" 
      hx-on:htmx:after-swap="scrollToBottom()"
      {% if scan.status in ["finished", "failed"] %}disabled{% endif %}
    >‚Üª –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥</button>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ -->
    <div id="buttons-container">
      {% if scan.status in ["finished", "failed"] %}
        <br><br>
        <a href="/report/{{ scan.id }}">üìÑ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ç—á—ë—Ç—É</a>
        <a href="/scan/{{ scan.id }}/chain" target="_blank" style="margin-left: 1rem;">‚õìÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å —Ü–µ–ø–æ—á–∫—É –∞—Ç–∞–∫</a>
      {% endif %}
    </div>

    <!-- HTMX-—Ç—Ä–µ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ -->
    <button
      hx-get="/scan/{{ scan.id }}/buttons"
      hx-trigger="every 2s"
      hx-target="#buttons-container"
      hx-swap="outerHTML"
      style="display:none;"
      {% if scan.status in ["finished", "failed"] %}disabled{% endif %}
    ></button>

  </div>
</body>
</html>